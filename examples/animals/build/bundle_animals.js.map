{"version":3,"file":"bundle_animals.js","sources":["../src/outside/tsne_module.js","../src/core/viewobj.js","../src/core/helpers.js","../animals.js"],"sourcesContent":["\r\n\r\n\r\n\r\n  // utility function\r\n  var assert = function(condition, message) {\r\n    if (!condition) { throw message || \"Assertion failed\"; }\r\n  }\r\n\r\n  // syntax sugar\r\n  var getopt = function(opt, field, defaultval) {\r\n    if(opt.hasOwnProperty(field)) {\r\n      return opt[field];\r\n    } else {\r\n      return defaultval;\r\n    }\r\n  }\r\n\r\n  // return 0 mean unit standard deviation random number\r\n  var return_v = false;\r\n  var v_val = 0.0;\r\n  var gaussRandom = function() {\r\n    if(return_v) { \r\n      return_v = false;\r\n      return v_val; \r\n    }\r\n    var u = 2*Math.random()-1;\r\n    var v = 2*Math.random()-1;\r\n    var r = u*u + v*v;\r\n    if(r == 0 || r > 1) return gaussRandom();\r\n    var c = Math.sqrt(-2*Math.log(r)/r);\r\n    v_val = v*c; // cache this for next function call for efficiency\r\n    return_v = true;\r\n    return u*c;\r\n  }\r\n\r\n  // return random normal number\r\n  var randn = function(mu, std){ return mu+gaussRandom()*std; }\r\n\r\n  // utilitity that creates contiguous vector of zeros of size n\r\n  var zeros = function(n) {\r\n    if(typeof(n)==='undefined' || isNaN(n)) { return []; }\r\n    if(typeof ArrayBuffer === 'undefined') {\r\n      // lacking browser support\r\n      var arr = new Array(n);\r\n      for(var i=0;i<n;i++) { arr[i]= 0; }\r\n      return arr;\r\n    } else {\r\n      return new Float64Array(n); // typed arrays are faster\r\n    }\r\n  }\r\n\r\n  // utility that returns 2d array filled with random numbers\r\n  // or with value s, if provided\r\n  var randn2d = function(n,d,s) {\r\n    var uses = typeof s !== 'undefined';\r\n    var x = [];\r\n    for(var i=0;i<n;i++) {\r\n      var xhere = [];\r\n      for(var j=0;j<d;j++) { \r\n        if(uses) {\r\n          xhere.push(s); \r\n        } else {\r\n          xhere.push(randn(0.0, 1e-4)); \r\n        }\r\n      }\r\n      x.push(xhere);\r\n    }\r\n    return x;\r\n  }\r\n\r\n  // compute L2 distance between two vectors\r\n  var L2 = function(x1, x2) {\r\n    var D = x1.length;\r\n    var d = 0;\r\n    for(var i=0;i<D;i++) { \r\n      var x1i = x1[i];\r\n      var x2i = x2[i];\r\n      d += (x1i-x2i)*(x1i-x2i);\r\n    }\r\n    return d;\r\n  }\r\n\r\n  // compute pairwise distance in all vectors in X\r\n  var xtod = function(X) {\r\n    var N = X.length;\r\n    var dist = zeros(N * N); // allocate contiguous array\r\n    for(var i=0;i<N;i++) {\r\n      for(var j=i+1;j<N;j++) {\r\n        var d = L2(X[i], X[j]);\r\n        dist[i*N+j] = d;\r\n        dist[j*N+i] = d;\r\n      }\r\n    }\r\n    return dist;\r\n  }\r\n\r\n  // compute (p_{i|j} + p_{j|i})/(2n)\r\n  var d2p = function(D, perplexity, tol) {\r\n    var Nf = Math.sqrt(D.length); // this better be an integer\r\n    var N = Math.floor(Nf);\r\n    assert(N === Nf, \"D should have square number of elements.\");\r\n    var Htarget = Math.log(perplexity); // target entropy of distribution\r\n    var P = zeros(N * N); // temporary probability matrix\r\n\r\n    var prow = zeros(N); // a temporary storage compartment\r\n    for(var i=0;i<N;i++) {\r\n      var betamin = -Infinity;\r\n      var betamax = Infinity;\r\n      var beta = 1; // initial value of precision\r\n      var done = false;\r\n      var maxtries = 50;\r\n\r\n      // perform binary search to find a suitable precision beta\r\n      // so that the entropy of the distribution is appropriate\r\n      var num = 0;\r\n      while(!done) {\r\n        //debugger;\r\n\r\n        // compute entropy and kernel row with beta precision\r\n        var psum = 0.0;\r\n        for(var j=0;j<N;j++) {\r\n          var pj = Math.exp(- D[i*N+j] * beta);\r\n          if(i===j) { pj = 0; } // we dont care about diagonals\r\n          prow[j] = pj;\r\n          psum += pj;\r\n        }\r\n        // normalize p and compute entropy\r\n        var Hhere = 0.0;\r\n        for(var j=0;j<N;j++) {\r\n          if(psum == 0) {\r\n             var pj = 0;\r\n          } else {\r\n             var pj = prow[j] / psum;\r\n          }\r\n          prow[j] = pj;\r\n          if(pj > 1e-7) Hhere -= pj * Math.log(pj);\r\n        }\r\n\r\n        // adjust beta based on result\r\n        if(Hhere > Htarget) {\r\n          // entropy was too high (distribution too diffuse)\r\n          // so we need to increase the precision for more peaky distribution\r\n          betamin = beta; // move up the bounds\r\n          if(betamax === Infinity) { beta = beta * 2; }\r\n          else { beta = (beta + betamax) / 2; }\r\n\r\n        } else {\r\n          // converse case. make distrubtion less peaky\r\n          betamax = beta;\r\n          if(betamin === -Infinity) { beta = beta / 2; }\r\n          else { beta = (beta + betamin) / 2; }\r\n        }\r\n\r\n        // stopping conditions: too many tries or got a good precision\r\n        num++;\r\n        if(Math.abs(Hhere - Htarget) < tol) { done = true; }\r\n        if(num >= maxtries) { done = true; }\r\n      }\r\n\r\n      // console.log('data point ' + i + ' gets precision ' + beta + ' after ' + num + ' binary search steps.');\r\n      // copy over the final prow to P at row i\r\n      for(var j=0;j<N;j++) { P[i*N+j] = prow[j]; }\r\n\r\n    } // end loop over examples i\r\n\r\n    // symmetrize P and normalize it to sum to 1 over all ij\r\n    var Pout = zeros(N * N);\r\n    var N2 = N*2;\r\n    for(var i=0;i<N;i++) {\r\n      for(var j=0;j<N;j++) {\r\n        Pout[i*N+j] = Math.max((P[i*N+j] + P[j*N+i])/N2, 1e-100);\r\n      }\r\n    }\r\n\r\n    return Pout;\r\n  }\r\n\r\n  // helper function\r\n  function sign(x) { return x > 0 ? 1 : x < 0 ? -1 : 0; }\r\n\r\n\r\n  // CONVERT TO CLASS\r\nexport class tSNE {\r\n  constructor(opt){\r\n\t\t  \r\n\tvar opt = opt || {};\r\n\tthis.perplexity = getopt(opt, \"perplexity\", 30); // effective number of nearest neighbors\r\n\tthis.dim = getopt(opt, \"dim\", 2); // by default 2-D tSNE\r\n\tthis.epsilon = getopt(opt, \"epsilon\", 10); // learning rate\r\n\r\n\tthis.iter = 0;\r\n\t\t  \r\n  } // constructor\r\n\t  \r\n\t  \r\n  // this function takes a set of high-dimensional points\r\n  // and creates matrix P from them using gaussian kernel\r\n  initDataRaw(X){\r\n    var N = X.length;\r\n    var D = X[0].length;\r\n    assert(N > 0, \" X is empty? You must have some data!\");\r\n    assert(D > 0, \" X[0] is empty? Where is the data?\");\r\n    var dists = xtod(X); // convert X to distances using gaussian kernel\r\n    this.P = d2p(dists, this.perplexity, 1e-4); // attach to object\r\n    this.N = N; // back up the size of the dataset\r\n    this.initSolution(); // refresh this\r\n  } // initDataRaw\r\n\r\n  // this function takes a given distance matrix and creates\r\n  // matrix P from them.\r\n  // D is assumed to be provided as a list of lists, and should be symmetric\r\n  initDataDist(D) {\r\n    var N = D.length;\r\n    assert(N > 0, \" X is empty? You must have some data!\");\r\n    // convert D to a (fast) typed array version\r\n    var dists = zeros(N * N); // allocate contiguous array\r\n    for(var i=0;i<N;i++) {\r\n      for(var j=i+1;j<N;j++) {\r\n        var d = D[i][j];\r\n        dists[i*N+j] = d;\r\n        dists[j*N+i] = d;\r\n      }\r\n    }\r\n    this.P = d2p(dists, this.perplexity, 1e-4);\r\n    this.N = N;\r\n    this.initSolution(); // refresh this\r\n  } // initDataDist\r\n\r\n  // (re)initializes the solution to random\r\n  initSolution() {\r\n    // generate random solution to t-SNE\r\n    this.Y = randn2d(this.N, this.dim); // the solution\r\n    this.gains = randn2d(this.N, this.dim, 1.0); // step gains to accelerate progress in unchanging directions\r\n    this.ystep = randn2d(this.N, this.dim, 0.0); // momentum accumulator\r\n    this.iter = 0;\r\n  } // initSolution\r\n\r\n  // return pointer to current solution\r\n  getSolution() {\r\n    return this.Y;\r\n  } // getSolution\r\n\r\n  // perform a single step of optimization to improve the embedding\r\n  step() {\r\n    this.iter += 1;\r\n    var N = this.N;\r\n\r\n    var cg = this.costGrad(this.Y); // evaluate gradient\r\n    var cost = cg.cost;\r\n    var grad = cg.grad;\r\n\r\n    // perform gradient step\r\n    var ymean = zeros(this.dim);\r\n    for(var i=0;i<N;i++) {\r\n      for(var d=0;d<this.dim;d++) {\r\n        var gid = grad[i][d];\r\n        var sid = this.ystep[i][d];\r\n        var gainid = this.gains[i][d];\r\n\r\n        // compute gain update\r\n        var newgain = sign(gid) === sign(sid) ? gainid * 0.8 : gainid + 0.2;\r\n        if(newgain < 0.01) newgain = 0.01; // clamp\r\n        this.gains[i][d] = newgain; // store for next turn\r\n\r\n        // compute momentum step direction\r\n        var momval = this.iter < 250 ? 0.5 : 0.8;\r\n        var newsid = momval * sid - this.epsilon * newgain * grad[i][d];\r\n        this.ystep[i][d] = newsid; // remember the step we took\r\n\r\n        // step!\r\n        this.Y[i][d] += newsid; \r\n\r\n        ymean[d] += this.Y[i][d]; // accumulate mean so that we can center later\r\n      } // for\r\n    } // for\r\n\r\n    // reproject Y to be zero mean\r\n    for(var i=0;i<N;i++) {\r\n      for(var d=0;d<this.dim;d++) {\r\n        this.Y[i][d] -= ymean[d]/N;\r\n      }\r\n    }\r\n\r\n    //if(this.iter%100===0) console.log('iter ' + this.iter + ', cost: ' + cost);\r\n    return cost; // return current cost\r\n  } // step\r\n\r\n  // for debugging: gradient check\r\n  debugGrad() {\r\n    var N = this.N;\r\n\r\n    var cg = this.costGrad(this.Y); // evaluate gradient\r\n    var cost = cg.cost;\r\n    var grad = cg.grad;\r\n\r\n    var e = 1e-5;\r\n    for(var i=0;i<N;i++) {\r\n      for(var d=0;d<this.dim;d++) {\r\n        var yold = this.Y[i][d];\r\n\r\n        this.Y[i][d] = yold + e;\r\n        var cg0 = this.costGrad(this.Y);\r\n\r\n        this.Y[i][d] = yold - e;\r\n        var cg1 = this.costGrad(this.Y);\r\n          \r\n        var analytic = grad[i][d];\r\n        var numerical = (cg0.cost - cg1.cost) / ( 2 * e );\r\n        console.log(i + ',' + d + ': gradcheck analytic: ' + analytic + ' vs. numerical: ' + numerical);\r\n\r\n        this.Y[i][d] = yold;\r\n      }\r\n    }\r\n  } // debugGrad\r\n\r\n  // return cost and gradient, given an arrangement\r\n  costGrad(Y) {\r\n    var N = this.N;\r\n    var dim = this.dim; // dim of output space\r\n    var P = this.P;\r\n\r\n    var pmul = this.iter < 100 ? 4 : 1; // trick that helps with local optima\r\n\r\n    // compute current Q distribution, unnormalized first\r\n    var Qu = zeros(N * N);\r\n    var qsum = 0.0;\r\n    for(var i=0;i<N;i++) {\r\n      for(var j=i+1;j<N;j++) {\r\n        var dsum = 0.0;\r\n        for(var d=0;d<dim;d++) {\r\n          var dhere = Y[i][d] - Y[j][d];\r\n          dsum += dhere * dhere;\r\n        }\r\n        var qu = 1.0 / (1.0 + dsum); // Student t-distribution\r\n        Qu[i*N+j] = qu;\r\n        Qu[j*N+i] = qu;\r\n        qsum += 2 * qu;\r\n      }\r\n    }\r\n    // normalize Q distribution to sum to 1\r\n    var NN = N*N;\r\n    var Q = zeros(NN);\r\n    for(var q=0;q<NN;q++) { Q[q] = Math.max(Qu[q] / qsum, 1e-100); }\r\n\r\n    var cost = 0.0;\r\n    var grad = [];\r\n    for(var i=0;i<N;i++) {\r\n      var gsum = new Array(dim); // init grad for point i\r\n      for(var d=0;d<dim;d++) { gsum[d] = 0.0; }\r\n      for(var j=0;j<N;j++) {\r\n        cost += - P[i*N+j] * Math.log(Q[i*N+j]); // accumulate cost (the non-constant portion at least...)\r\n        var premult = 4 * (pmul * P[i*N+j] - Q[i*N+j]) * Qu[i*N+j];\r\n        for(var d=0;d<dim;d++) {\r\n          gsum[d] += premult * (Y[i][d] - Y[j][d]);\r\n        }\r\n      }\r\n      grad.push(gsum);\r\n    }\r\n\r\n    return {cost: cost, grad: grad};\r\n  } // costGrad\r\n\t  \r\n\t  \r\n} // tSNE\r\n  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import * as d3 from \"d3\"\r\n\r\nexport default class viewobj {\r\n  static spritewidth = 64\r\n\t\r\n  constructor(div, v2p){\r\n\tthis.div = div\r\n\tthis.spritewidth = viewobj.spritewidth\r\n\t\r\n\tthis.scales = {\r\n\t  x: d3.scaleLinear()\r\n\t\t.domain( [0, div.offsetWidth*v2p ] )\r\n\t\t.range(  [0, div.offsetWidth     ] ),\r\n\t  y: d3.scaleLinear()\r\n\t\t.domain( [0, div.offsetHeight*v2p ] )\r\n\t\t.range(  [0, div.offsetHeight     ] )\r\n\t} // scales\r\n\t\r\n\tthis.current = {\r\n\t  x: [0, div.offsetWidth*v2p ],\r\n\t  y: [0, div.offsetHeight*v2p],\r\n\t  v2p: v2p\r\n\t} // current\r\n\t\t\r\n  } // constructor\r\n  \r\n  transform(){\r\n\t\r\n\t// d3/event.transform keeps track of the zoom based on the initial state. Therefore if the scale domain is actually changed, the changes compound later on!! Either reset the event tracker, or keep the domain unchanged, and just update separate view coordinates.\r\n\tlet view = this.current\r\n\tview.x = d3.event.transform.rescaleX( this.scales.x ).domain()\r\n\tview.y = d3.event.transform.rescaleY( this.scales.y ).domain()\r\n\t\r\n\tlet v2p_new = (view.x[1] - view.x[0]) / this.div.offsetWidth\r\n\tlet k = v2p_new / view.v2p\r\n\tview.v2p = v2p_new\r\n\t\r\n\tthis.spritewidth = this.spritewidth / k;\r\n\t\r\n  } // transform\r\n\t\r\n  pixel2data(pixelpoint){\r\n\t// Transform into the data values. B\r\n\tlet view = this.current\r\n\tlet dom = {\r\n\t\tx: [0, this.div.offsetWidth ], \r\n\t\ty: [0, this.div.offsetHeight]\r\n\t}\r\n\t\r\n\treturn canvasobj.domA2domB(pixelpoint, dom, view)\r\n  } // pixel2data\r\n\t\r\n  data2pixel(datapoint){\r\n\t// Transform into the data values. B\r\n\tlet view = this.current\r\n\tlet dom = {\r\n\t\tx: [0, this.div.offsetWidth], \r\n\t\ty: [0, this.div.offsetHeight]\r\n\t}\r\n\t  \r\n\treturn canvasobj.domA2domB(datapoint, view, dom)\r\n  } // pixel2data\r\n\t\r\n  static domA2domB(point, A, B){\r\n\t// Convert a single point `point' from a domain defined by `A' to a domain defined by `B'. `A' and `B' both require to have `x' and `y' attributes, which are arrays of length 2.\r\n\t\r\n\tlet x = d3.scaleLinear()\r\n\t  .domain( A.x )\r\n\t  .range( B.x )\r\n\t\t\r\n\tlet y = d3.scaleLinear()\r\n\t  .domain( A.y )\r\n\t  .range( B.y )\r\n\t\t  \r\n\treturn [ x( point[0] ), y( point[1] )]\r\n  } // dom2view\r\n\t\r\n} // canvasobj","\r\n// Refactor into blocks??\r\n\r\n// General helpers\r\nexport var helpers = {\r\n\t\r\n\t\tisIterable: function isIterable(object) {\r\n\t\t  // https://stackoverflow.com/questions/18884249/checking-whether-something-is-iterable\r\n\t\t  return object != null && typeof object[Symbol.iterator] === 'function'\r\n\t\t}, // isIterable\r\n\t\r\n\t\tmakeTranslate: function makeTranslate(x,y){\r\n\t\t\treturn \"translate(\" + x + \",\" + y + \")\"\r\n\t\t}, // makeTranslate\r\n\t\r\n\t\t// Arrays\r\n\t\tunique: function unique(d){\t\t\r\n\t\t\t// https://stackoverflow.com/questions/1960473/get-all-unique-values-in-a-javascript-array-remove-duplicates\r\n\t\t\tfunction onlyUnique(value, index, self) { \r\n\t\t\t\treturn self.indexOf(value) === index;\r\n\t\t\t} // unique\r\n\t\t\t\r\n\t\t\treturn d.filter( onlyUnique )\r\n\t\t\r\n\t\t}, // unique\r\n\t\t\r\n\t\tarrayEqual: function arrayEqual(A, B){\r\n\t\t\t\r\n\t\t\treturn helpers.arrayIncludesAll(A, B)\r\n\t\t\t\t&& helpers.arrayIncludesAll(B, A)\r\n\t\t\t\r\n\t\t}, // arrayEqual\r\n\t\t\r\n\t\tarrayIncludesAll: function arrayIncludesAll(A,B){\r\n\t\t\t// 'arrayIncludesAll' checks if array A includes all elements of array B. The elements of the arrays are expected to be strings.\r\n\t\t\t\r\n\t\t\t// Return element of B if it is not contained in A. If the response array has length 0 then A includes all elements of B, and 'true' is returned.\r\n\t\t\tvar f = B.filter(function(b){\r\n\t\t\t\treturn !A.includes(b)\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\treturn f.length == 0? true : false\r\n\t\t\t\r\n\t\t\t\r\n\t\t}, // arrayIncludesAll\r\n\t\t\r\n\t\tindexOfObjectByAttr: function indexOfObjectByAttr(array, attr, value) {\r\n\t\t\t// Return hte index of the first object with the attribute 'attr' of value 'value'. \r\n\t\t\tfor(var i = 0; i < array.length; i += 1) {\r\n\t\t\t\tif(array[i][attr] === value) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}, // indexOfObjectByAttr\r\n\t\t\r\n\t\tfindObjectByAttribute: function findObjectByAttribute(A, attribute, values, flag){\r\n\t\t\t// Return the objects in an object array 'A', which have an attribute 'attribute', with the value 'value'. If they do not an empty set is returned. In cases when a single item is selected the item is returned as the object, without the wrapping array.\r\n\t\t\t\t\r\n\t\t\tvar subset = A.filter(function(a){\r\n\t\t\t\treturn values.includes( a[attribute] )\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t// If only one output is expected, return a single output.\r\n\t\t\tif( subset.length > 0 && flag == 1 ){\r\n\t\t\t\tsubset = subset[0]\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t\treturn subset\r\n\t\t\t\r\n\t\t}, // findObjectByAttribute\r\n\t\t\r\n\t\tcollectObjectArrayProperty: function collectObjectArrayProperty(A, attribute){\r\n\t\t\t// Take input object array 'A', collect all of the object members attribute 'attribute', and flattens the array of arrays into a single array of values once.\r\n\t\t\r\n\t\t\tvar C = A.map(function(a){\r\n\t\t\t\treturn a[attribute]\r\n\t\t\t})\r\n\t\t\treturn [].concat.apply([], C)\t\r\n\t\t\r\n\t\t}, // collectObjectArrayProperty\r\n\t\t\r\n\t\tsetDifference: function (A, B){\r\n\t\t\t\r\n\t\t\tlet a = new Set(A);\r\n\t\t\tlet b = new Set(B);\r\n\t\t\t\r\n\t\t\treturn { \r\n\t\t\t  aMinusB: new Set([...a].filter(x => !b.has(x))),\r\n\t\t\t  bMinusA: new Set([...b].filter(x => !a.has(x)))\r\n\t\t\t}\r\n\t\t}, // setDifference\r\n\t\t\r\n\t\t// Comparing file contents\r\n\t\t\r\n\t\t\r\n\t\t// Text sizing\r\n\t\tfitTextToBox: function fitTextToBox(text, box, dim, val){\r\n\t\t\t// `text' and `box' are d3 selections. `dim' must be either `width' or `height', and `val' must be a number.\r\n\r\n\t\t\t\r\n\t\t\tif( [\"width\", \"height\"].includes(dim) && !isNaN(val) ){\r\n\t\t\t\r\n\t\t\t\tlet fontSize = 16\r\n\t\t\t\ttext.style(\"font-size\", fontSize + \"px\")\r\n\t\t\t\twhile( ( box.node().getBoundingClientRect()[dim] > val ) &&\r\n\t\t\t\t\t   ( fontSize > 0 )\t){\r\n\t\t\t\t\t// Reduce the font size\r\n\t\t\t\t\tfontSize -= 1\r\n\t\t\t\t\ttext.style(\"font-size\", fontSize + \"px\")\r\n\t\t\t\t\t\r\n\t\t\t\t} // while\r\n\t\t\t\r\n\t\t\t} // if\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t}, // fitTextToBox\r\n\t\t\r\n\t\tcalculateExponent: function(val){\r\n\t\t\t// calculate the exponent for the scientific notation.\r\n\t\t\tvar exp = 0\r\n\t\t\twhile( Math.floor( val / 10**(exp+1) ) > 0 ){ exp+=1 }\r\n\t\t\t\r\n\t\t\t// Convert the exponent to multiple of three\r\n\t\t\treturn Math.floor( exp / 3 )*3\r\n\t\t\r\n\t\t}, // calculateExponent\r\n\t\t\r\n\t\t\r\n\t\t// FILES\r\n\t\tcreateFileInputElement: function createFileInputElement(loadFunction){\r\n\t\t\t\r\n\t\t\t// This button is already created. Just add the functionaity.\r\n\t\t\tvar dataInput = document.createElement('input');\r\n\t\t\tdataInput.type = 'file';\r\n\r\n\t\t\tdataInput.onchange = function(e){\r\n\t\t\t\tloadFunction(e.target.files)\r\n\t\t\t}; // onchange\r\n\t\t\t\r\n\t\t  return dataInput\r\n\t\t\t\r\n\t\t}, // createFileInputElement\r\n\t   \r\n\t\t\r\n} // helpers\r\n\t","import * as tsnejs from \"./src/outside/tsne_module.js\"\r\nimport viewobj from \"./src/core/viewobj.js\"\r\nimport { helpers } from \"./src/core/helpers.js\"\r\nimport * as d3 from \"d3\"\r\n\r\n// `t-sne' module adapted from: https://github.com/karpathy/tsnejs\r\n\r\n\r\n// Load in the metadata.\r\n// \"c:\\Users\\ak2164\\Documents\\CAMBRIDGE\\PhD\\demo\\data\\merged_micrograph_sample.csv\"\r\n\r\nvar dbsliceData = {\r\n\tsprites: [],\r\n\tselected: [],\r\n\thiding: [],\r\n\ttsnesettings: undefined,\r\n\tview: undefined\r\n}\r\n\r\nd3.csv(\"./data/animal_metadata.csv\").then(function(metadata){\r\n\t\r\n\t// Convert the values to numbers.\r\n\tmetadata.forEach(function(row){\r\n\t\tordinals.forEach(function(varname){\r\n\t\t\trow[varname] = Number(row[varname])\r\n\t\t}) // forEach\r\n\t}) // forEach\r\n\t\r\n\t// Actual sprites\r\n\tdbsliceData.sprites = metadata.map(function(task){\r\n\t\treturn {\r\n\t\t\ttask: task,\r\n\t\t\tmouse: undefined,\r\n\t\t\tposition: undefined\r\n\t\t}\r\n\t}) // map\r\n\t\r\n\tdbsliceData.tsnesettings = new tsnesettings()\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\t// The t-SNE scores are z-scored in hte end, so hte val2px is controlled here. So let's leave 100px on either side empty, and the area in between should span 1\r\n\tvar div = d3.select(\"#root\")\r\n\tlet v2p = 1 / (div.node().offsetWidth - 400)\r\n\tvar view = new viewobj(div.node(), v2p)\r\n\tdbsliceData.view = view;\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Add an image for every path in the metadata? Start with first 10.\r\n\t// get the t-sne scores\r\n\tgettsnescores(dbsliceData.sprites)\r\n\t\t\r\n\t\r\n\t\r\n\t// Add the zooming\r\n\tdiv.call(d3.zoom().scaleExtent([0.01, Infinity])\r\n\t   .on(\"zoom\", function(obj){\r\n\t\tview.transform()\r\n\t\tzooming(view)\r\n\t}))\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tlet dragobj = d3.drag()\r\n\t.on(\"start\", function(d){\r\n\t\td.mouse = getMousePosition()\r\n\t})\r\n\t.on(\"drag\", function(d){\r\n\t\tlet position = calculateNewPosition(d, this)\r\n\t\t\t\t\r\n\t\t// Move the wrapper.\r\n\t\td3.select( this )\r\n\t\t  .style(\"left\",position.x + \"px\")\r\n\t\t  .style(\"top\",position.y + \"px\")\r\n\t})\r\n\t.on(\"end\", function(d){\r\n\t\tlet xscale = d3.scaleLinear()\r\n\t\t  .domain(view.current.x)\r\n\t\t  .range([0, view.div.offsetWidth])\r\n\t\t\r\n\t\tlet yscale = d3.scaleLinear()\r\n\t\t  .domain(view.current.y)\r\n\t\t  .range([0, view.div.offsetHeight])\r\n\t\t  \r\n\t\td.position = [\r\n\t\t\txscale.invert(parseFloat( this.style.left)),\r\n\t\t\tyscale.invert(parseFloat( this.style.top))\r\n\t\t]\r\n\t})\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// ./data/uhcsdata/micrographs/\r\n\td3.select(\"div.content\")\r\n\t  .selectAll(\"img\")\r\n\t  .data( dbsliceData.sprites )\r\n\t  .enter()\r\n\t\t.append(\"img\")\r\n\t\t.attr(\"src\", d=>\"./data/jpgs_for_AK/\" + d.task.path + \".jpeg\")\r\n\t\t.attr(\"width\", 64)\r\n\t\t.attr(\"height\", 52)\r\n\t\t.style(\"position\", \"absolute\")\r\n\t\t.style(\"left\", d=>view.scales.x(d.position[0])+\"px\")\r\n\t\t.style(\"top\", d=>view.scales.y(d.position[1])+\"px\")\r\n\t\t.call(dragobj)\r\n\t\t\r\n\t// Add the reference to the DOM to the sprites.\r\n\td3.select(\"div.content\")\r\n\t  .selectAll(\"img\")\r\n\t  .each(function(sprite){\r\n\t\t  sprite.graphic = this\r\n\t  })\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t// Create a lasso.\r\n\tlet parentobj = {\r\n\t\tonlassostart: function(){\r\n\t\t\tdbsliceData.selected = []\r\n\t\r\n\t\t\td3.select(\"div.content\")\r\n\t\t\t  .selectAll(\"img\")\r\n\t\t\t  .style(\"border\", \"\")\r\n\t\t\t\r\n\t\t},\r\n\t\tonlassoend: function(){\r\n\t\t\t// Find all hte circled images.\r\n\t\t\tvar obj = this \r\n\t\t\t\r\n\t\t\tlet selected = dbsliceData.sprites.filter(function(sprite){\r\n\t\t\t\tlet point = [\r\n\t\t\t\t\tparseFloat( sprite.graphic.style.left ),\r\n\t\t\t\t\tparseFloat( sprite.graphic.style.top )\r\n\t\t\t\t]\r\n\t\t\t\treturn obj.lassoobj.iswithin(point)\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tselected.forEach(function(sprite){\r\n\t\t\t\tsprite.graphic.style.border = \"4px solid purple\"\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tdbsliceData.selected = selected\r\n\t\t\t\r\n\t\t},\r\n\t}\r\n\tlet overlay = d3.select(\"#overlay\").node()\r\n\tparentobj.lassoobj = new lasso(overlay, parentobj)\r\n\t\r\n\t\r\n\t\r\n})\r\n\t\t\r\n\t\t\r\n\r\n\t\r\n// zooming\r\nfunction zooming(view){\r\n\t\r\n\tlet xscale = d3.scaleLinear()\r\n\t  .domain(view.current.x)\r\n\t  .range([0, view.div.offsetWidth])\r\n\t\r\n\tlet yscale = d3.scaleLinear()\r\n\t  .domain(view.current.y)\r\n\t  .range([0, view.div.offsetHeight])\r\n\t\r\n\td3.select(\"div.content\")\r\n\t  .selectAll(\"img\")\r\n\t  .attr(\"width\", view.spritewidth)\r\n\t  .attr(\"height\", view.spritewidth/64*52)\r\n\t  .style(\"left\", d=>xscale(d.position[0])+\"px\")\r\n\t  .style(\"top\", d=>yscale(d.position[1])+\"px\")\r\n\t\r\n} // zooming\r\n\r\n// repositioning via t-sne\r\nfunction reposition(){\r\n\t\r\n\t// Update the positions in the storage.\r\n\tgettsnescores(dbsliceData.sprites)\r\n\t\r\n\t// Update on-screen positions.\r\n\td3.select(\"div.content\")\r\n\t  .selectAll(\"img\")\t\r\n\t\t.style(\"left\", d=>dbsliceData.view.scales.x(d.position[0])+\"px\")\r\n\t\t.style(\"top\", d=>dbsliceData.view.scales.y(d.position[1])+\"px\")\r\n\t\t\r\n\t\r\n} // reposition\r\n\r\n\t\r\n// t-SNE\r\nfunction gettsnescores(sprites){\r\n\r\n\t// Which metadtata to use\r\n\tvar animalsinfo = sprites.map(function(sprite){\r\n\t\tlet feature = []\r\n\t\tordinals.forEach(function(varname){\r\n\t\t\tfeature.push(sprite.task[varname])\r\n\t\t}) // forEach\r\n\t\treturn feature\r\n\t}) // map\r\n\t\r\n\t\r\n\t\r\n\t// The options MUST be configured correctly for t-sne to produce meaningful results!!\r\n\t// perplexity must be smaller than the number of actual cases, maybe a third or so?\r\n\t\r\n\t// var opt = {}\r\n\t// opt.epsilon = 10; // epsilon is learning rate (10 = default)\r\n\t// opt.perplexity = Math.round( animalsinfo.length / 5 ); // roughly how many neighbors each point influences (30 = default)\r\n\t// opt.dim = 2; // dimensionality of the embedding (2 = default)\r\n\tvar opt = dbsliceData.tsnesettings.data\r\n\r\n\tvar tsne = new tsnejs.tSNE(opt); // create a tSNE instance\r\n\r\n\t// initialize the raw data.\r\n\ttsne.initDataRaw(animalsinfo);\r\n\r\n\tfor(var k = 0; k < 5000; k++) {\r\n\t  tsne.step(); // every time you call this, solution gets better\r\n\t} // for\r\n\r\n\tvar Y = tsne.getSolution(); // Y is an array of 2-D points that you can plot\r\n\t\r\n\t\r\n\t// This z-score should erally be axis sensitive.\r\n\tlet xdom = d3.extent(Y, d=>d[0])\r\n\tlet ydom = d3.extent(Y, d=>d[1])\r\n\t\r\n\tsprites.forEach(function(sprite, i){\r\n\t\t// Give the position in [0, 1]\r\n\t\tsprite.position = [ \r\n\t\t\t( Y[i][0] - xdom[0] )/( xdom[1] - xdom[0] ),\r\n\t\t\t( Y[i][1] - ydom[0] )/( ydom[1] - ydom[0] )\r\n\t\t]\r\n\t}) // forEach\r\n\r\n} // gettsnescores\r\n\r\n\r\n// tsnesettings\r\nclass tsnesettings {\r\n\r\n  constructor(){\r\n\t// Has to have the graphic,\r\n\tthis.graphic = {\r\n\t\twrapper: undefined,\r\n\t\tposition: {}\r\n\t} // graphic\r\n\t\r\n\tlet p = Math.round( dbsliceData.sprites.length / 5 );\r\n\tthis.data = {\r\n\t\tepsilon: 10,\r\n\t\tperplexity: p < 2 ? 2 : p,\r\n\t\tdim: 2\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t// Make the toolbar.\r\n\tvar d3toolbar = d3.select(\"#animals\")\r\n\t  .append(\"div\")\r\n\t\t.attr(\"class\", \"tagging\")\r\n\t\t.style(\"display\", \"none\")\r\n\t\t.style(\"cursor\", \"pointer\")\r\n\tthis.graphic.wrapper = d3toolbar.node()\r\n\r\n\t// Add the dragging.\r\n\tlet dragobj = d3.drag()\r\n\t\t.on(\"start\", function(d){\r\n\t\t\td.mouse = getMousePosition()\r\n\t\t})\r\n\t\t.on(\"drag\", function(d){\r\n\t\t\tlet position = calculateNewPosition(d, this)\r\n\t\t\t\t\t\r\n\t\t\t// Move the wrapper.\r\n\t\t\td3.select( this )\r\n\t\t\t  .style(\"left\",position.x + \"px\")\r\n\t\t\t  .style(\"top\",position.y + \"px\")\r\n\t\t})\r\n\t\t.on(\"end\", function(d){\r\n\t\t\tlet xscale = d3.scaleLinear()\r\n\t\t\t  .domain(dbsliceData.view.current.x)\r\n\t\t\t  .range([0, dbsliceData.view.div.offsetWidth])\r\n\t\t\t\r\n\t\t\tlet yscale = d3.scaleLinear()\r\n\t\t\t  .domain(dbsliceData.view.current.y)\r\n\t\t\t  .range([0, dbsliceData.view.div.offsetHeight])\r\n\t\t\t  \r\n\t\t\td.position = [\r\n\t\t\t\txscale.invert(parseFloat( this.style.left)),\r\n\t\t\t\tyscale.invert(parseFloat( this.style.top))\r\n\t\t\t]\r\n\t\t})\r\n\t\t\r\n\td3toolbar.datum( this )\r\n\td3toolbar.call(dragobj)\r\n\r\n\r\n\t// MOVE? : Should the assemply of options be moved outside for greater flexibility? Also, how would I otherwise access the functionality required?? \r\n\tlet obj = this\r\n\t\r\n\t// Sliders\r\n\taddRange(\"perplexity\", \"perplexity\", 1, 100, 10)\r\n\taddRange(\"learn. rate\", \"epsilon\", 1, 100, 10)\r\n\t\r\n\t\r\n\taddButton(\"close\", function(d){\r\n\t\tobj.hide();\r\n\t})\r\n\taddButton(\"check\", function(d){\r\n\t\tobj.submit(); \r\n\t})\r\n\t\r\n\tfunction addButton(icon, event){\r\n\t  d3toolbar\r\n\t    .append(\"button\")\r\n\t\t  .attr(\"class\", \"btn-circle\")\r\n\t\t  .on(\"click\", event)\r\n\t    .append(\"i\")\r\n\t\t  .attr(\"class\", \"fa fa-\" + icon)\r\n\t\t  .style(\"cursor\", \"pointer\")\r\n\t} // addButton\r\n\t\r\n\tfunction addRange(text, classname, min, max, init){\r\n\t\t\r\n\t  let div = d3toolbar\r\n\t    .append(\"div\")\r\n\t\t  .style(\"display\", \"block\")\r\n\t\t  .style(\"font-family\", \"helvetica\")\r\n\t\t  .style(\"color\", \"black\")\r\n\t\t  .html(text)\r\n\t  div.append(\"input\")\r\n\t\t  .attr(\"class\", classname)\r\n\t      .attr(\"type\", \"range\")\r\n\t\t  .attr(\"min\", min)\r\n\t\t  .attr(\"max\", max)\r\n\t\t  .attr(\"value\", init)\r\n\t\t  .on(\"mousedown\", function(){\r\n\t\t\t  // Propagation must be stopped so that the movement is logged as input change, and not drag.\r\n\t\t\t  d3.event.stopPropagation()\r\n\t\t  })\r\n\t\t\r\n\t} // addRange\r\n\r\n  } // constructor\r\n  \r\n  submit(){\r\n\tvar obj = this\r\n\tobj.hide();\r\n\t\r\n\t// Set the selected values to obj.data\r\n\tlet perplexitynode = d3.select(obj.graphic.wrapper).select(\"input.perplexity\").node()\r\n\tlet epsilonnode = d3.select(obj.graphic.wrapper).select(\"input.epsilon\").node()\r\n\t\r\n\tobj.data.epsilon = epsilonnode.value\r\n\tobj.data.perplexity = perplexitynode.value\r\n\t\r\n\treposition()\r\n  } // submit\r\n\r\n  show(){\r\n\t// Position hte tooltip By finding the mean of all hte selected sprites.\r\n\tlet obj = this\r\n\t\r\n\t\r\n\t// Set the current settings to the ranges.\r\n\t\r\n\t// Offset by the expected tooltip size. How to calculate that when display:none?\r\n\tlet style = obj.graphic.wrapper.style\r\n\tstyle.display = \"block\"\r\n\tstyle.left = 20 + \"px\"\r\n\tstyle.top = 150 + \"px\"\r\n\t  \r\n\t  \r\n  }  // show\r\n\t\t\r\n  hide(){\r\n\tlet obj = this\r\n\tobj.graphic.wrapper.style.display = \"none\"\r\n  } // hide\r\n} // tsnesettings\r\n\r\n\r\n\r\n// dragging helpers\r\nfunction getMousePosition(){\t\t\r\n\tlet mousePosition = d3.mouse(d3.select(\"div.content\").node())\r\n\treturn {\r\n\t\tx: mousePosition[0],\r\n\t\ty: mousePosition[1]\r\n\t}\r\n} // getMousePosition\r\n\r\nfunction calculateNewPosition(d, wrapperdom){\r\n\t// Get the current wrapper position and the mouse movement on increment.\r\n\tlet wrapper = getWrapperPosition(wrapperdom)\r\n\tlet movement = calculateMouseMovement(d)\r\n\t\r\n\treturn {\r\n\t\tx: wrapper.x + movement.x,\r\n\t\ty: wrapper.y + movement.y\r\n\t}\r\n} // calculateNewPosition\r\n\r\nfunction getWrapperPosition(wrapperdom){\r\n\t// Calculate the position of the wrapper relative to it's parent\r\n\treturn {\r\n\t\tx: parseInt( wrapperdom.style.left ),\r\n\t\ty: parseInt( wrapperdom.style.top ),\r\n\t\tw: wrapperdom.offsetWidth,\r\n\t\th: wrapperdom.offsetHeight\r\n\t}\r\n\t\r\n} // getWrapperPosition\r\n\t\r\nfunction calculateMouseMovement(d){\r\n\t\r\n\tlet mp0 = d.mouse\r\n\tlet mp1 = getMousePosition()\r\n\t\r\n\tlet movement = {\r\n\t\tx: mp1.x - mp0.x,\r\n\t\ty: mp1.y - mp0.y\r\n\t}\r\n\t\r\n\td.mouse = mp1\r\n\r\n\treturn movement\r\n\t\r\n} // calculateMouseMovement\r\n\r\n// Lasso\r\nclass lasso {\r\n\t\r\n  /*\r\n\t`lasso' creates a new lasso instance, based on the `overlay' svg dom element. In addition to collecting the points selected by the user it also performs a user specified action on the start and end of lassoing.\r\n\t\r\n\tThe lasso only collects the selected region, and passes it to the user. The search for any data in the graphic must be done by the plot. Lasso does provide functionality (lasso.iswithin) to check whether a particular pixel on the svg is within it.\r\n  */\r\n  \t\r\n  constructor(overlay, parentobj){\r\n\t\r\n\t\r\n\t// Declare the most important attributes. Note that the lasso does NOT find it's own selected data! The `selected' attribute is only a placeholder here to allow the user to store the results in it. This is to simplify the lasso code by moving the data identification out.\r\n\tthis.svg = overlay\r\n\tthis.boundary = []\r\n\t\r\n\t\r\n\t// Add behavior to the overlay.\r\n\td3.select(overlay.parentElement).on(\"mousemove\", function(){\r\n\t  if (event.shiftKey) {\r\n\t\t  overlay.style.display = \"block\"\r\n\t  } else {\r\n\t\t  overlay.style.display = \"none\"\r\n\t  } // if\r\n\t}) // on\r\n\t\r\n\tlet obj = this\r\n\td3.select(overlay)\r\n\t  .call( d3.drag()\r\n\t\t.on(\"start\", function(){\r\n\t\t\t// Clear previous lasso, remove graphic, remove toolbar.\r\n\t\t\tobj.boundary = []\r\n\t\t\tobj.draw()\r\n\t\t\tparentobj.onlassostart(obj)\r\n\t\t}) // on\r\n\t\t.on(\"drag\", function(){\r\n\t\t\tobj.addpoint()\r\n\t\t\tobj.draw()\r\n\t\t}) // on\r\n\t\t.on(\"end\", function(){\r\n\t\t\tif(obj.boundary.length > 3){\r\n\t\t\t\tparentobj.onlassoend(obj)\r\n\t\t\t} // if\r\n\t\t\tobj.remove()\r\n\t\t}) // on\r\n\t  ) // call\r\n\t\r\n  } // constructor\r\n\r\n\r\n  \r\n\r\n  addpoint(){\r\n\tlet obj = this\r\n\tobj.boundary.push(d3.mouse(obj.svg))\r\n  } // addpoint\r\n  \r\n\r\n  iswithin(point){\r\n\t// Check wheteher the `point' is within the polygon defined by the boundary of the lasso in `this.boundary'. The check is based on the idea that any ray starting from `point' must pass the boundary an odd number of times if it is within it, and an even number of times otherwise. For simplicity a horizontal ray was selected. The boundary is imagined as straight segments between neighbouring points of `this.boundary'. Every segment is checked to see whether the ray crosses it. As the ray is expected to run in one dimension only, the `isInside' flag is only changed if the segment is a boundary segment, AND if the crossing point is to the right of the initial point. The check could be optimised further by only considering the part of the lasso that is to the right of the selected point. A separate improvement could allow the user to input an array of points to be checked.\r\n\tlet boundary = this.boundary\r\n\t\r\n\tvar isInside = false\r\n\tfor(let i=1; i<boundary.length; i++){\r\n\t\tcheckIntersect(boundary[i-1], boundary[i], point)\r\n\t} // for\r\n\tcheckIntersect(boundary[boundary.length-1], boundary[0], point)\r\n\t\r\n\treturn isInside\r\n\t\r\n\t// Need to check the same number of edge segments as vertex points. The last edge should be the last and the first point.\r\n\r\n\tfunction checkIntersect(p0, p1, point){\r\n\t\t// One point needs to be above, while the other needs to be below -> the above conditions must be different.\r\n\t\t\r\n\t\tif( (p0[1] > point[1]) !== (p1[1] > point[1]) ){\r\n\t\t\t// One is above, and the other below. Now find if the x are positioned so that the ray passes through. Essentially interpolate the x at the y of the point, and see if it is larger.\r\n\t\t\tlet x = (p1[0] - p0[0])/(p1[1] - p0[1])*(point[1] - p0[1]) + p0[0]\r\n\t\t\t\r\n\t\t\tisInside = x > point[0] ? !isInside : isInside\r\n\t\t\t\r\n\t\t} // if\r\n\t} // checkIntersect\r\n\r\n  } // iswithin\r\n\t\r\n  draw(){\r\n\tlet obj = this\r\n\t\r\n\t// Create the data for a single polygon\r\n\tvar d = [obj.boundary.map(d=>d.join()).join(\" \")]\r\n\t\r\n\td3.select(obj.svg)\r\n\t  .selectAll(\"polygon\")\r\n\t  .data(d)\r\n\t  .join(\r\n\t\tenter => enter.append(\"polygon\")\r\n\t\t  .attr(\"points\", d=>d)\r\n\t\t  .style(\"fill\", \"cornflowerblue\")\r\n\t\t  .style(\"stroke\", \"dodgerblue\")\r\n\t\t  .style(\"stroke-width\", 2)\r\n\t\t  .attr(\"opacity\", 0.4),\r\n\t\tupdate => update\r\n\t\t  .attr(\"points\", d=>d),\r\n\t\texit => exit.remove()\r\n\t  ) // join\r\n  } // draw\r\n\r\n  remove(){\r\n\tlet obj = this\r\n\td3.select(obj.svg)\r\n\t  .selectAll(\"polygon\")\r\n\t  .remove()\r\n  } // remove\r\n\t\r\n} // lasso\r\n\r\n\r\n\r\n\r\n\r\n// Correlations and we're done here\r\n// FOR THIS SOME ADDITIONAL METADATA WILL BE REQUIRED!!\r\n// These are the default ones. Now also check for any user defined ones. For user defined one\r\nvar categoricals = [\"animal\"]\r\nvar ordinals = []\r\nfor(let i=0; i<2048;i++){\r\n\tordinals.push(\"ftr_\"+i)\r\n} // for\r\n\r\n// The trending and statistics object.\r\nvar statistics = {\r\n\t\r\n\tcorrelation: function correlation(sprites){\r\n\t\t\r\n\t\t// Categorical variables\r\n\t\tlet categoricalscores = categoricals.map(function(cat){\r\n\t\t\treturn statistics.categoricalcorrelation(sprites, cat)\r\n\t\t}) // map\r\n\t\t\r\n\t\t// Ordinal variables.\r\n\t\tlet ordinalscores = ordinals.map(function(ord){\r\n\t\t\treturn statistics.ordinalcorrelation(sprites, ord)\r\n\t\t}) // map\r\n\t  \r\n\t    \r\n\t\t// Before returning the scores, order them.\r\n\t    let scores = categoricalscores.concat(ordinalscores)\r\n\t\tscores.sort(function(a,b){return Math.max(a.score.x, a.score.y) - Math.max(b.score.x, b.score.y)})\r\n\t  \r\n\t  return scores\r\n\t  \r\n\t}, // correlation\r\n\t\r\n\tcovariance: function covariance(d){\r\n\r\n\t\t// 'd' is an array of observations. Calculate the covariance between x and the metadata variable.\r\n\t\tlet N = d.length\r\n\t\tlet mu_var0 = d3.sum(d, d=>d.var0) / N\r\n\t\tlet mu_var1 = d3.sum(d, d=>d.var1) / N\r\n\t  \r\n\t  \r\n\t\tvar sum = 0;\r\n\t\tfor(var i=0; i< N; i++) {\r\n\t\t\tsum += ( d[i].var0 - mu_var0 )*( d[i].var1 - mu_var1 );\r\n\t\t}\r\n\t  \r\n\t\treturn 1/(N - 1)*sum\r\n\t\t\r\n\t}, // covariance\r\n\t\r\n\tspearman: function spearman(d){\r\n\t\t/* Get Spearman's rank correlation scores  (https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient) for the order in a direction.\r\n\t\t\t\r\n\t\tThe coefficient is:\r\n\t\t  covariance (rank_var0, rank_var1 )/( sigma(rank_var0) sigma(rank_var1) )\r\n\t\t*/\r\n\t\t\r\n\t\tlet cov = statistics.covariance(d)\r\n\t\tlet sigma_var0 = d3.deviation(d, d=>d.var0)\r\n\t\tlet sigma_var1 = d3.deviation(d, d=>d.var1)\r\n\t\t\r\n\t\tsigma_var0 = sigma_var0 == 0 ? Infinity : sigma_var0\r\n\t\tsigma_var1 = sigma_var1 == 0 ? Infinity : sigma_var1\r\n\t\t\r\n\t\treturn cov / ( sigma_var0*sigma_var1 )\r\n\t\t\r\n\t\t\r\n\t}, // spearman\r\n\t\r\n\tcategoricalmapping: function(sprites, variable){\r\n\t\t\r\n\t\tlet uniquevals = helpers.unique( sprites.map(function(sprite){\r\n\t\t\treturn sprite.task[variable]\r\n\t\t}) ) // unique\r\n\t\r\n\t\t// Find the appropriate mapping given the on-screen arrangement. For each unique categorical value calculate the median.\r\n\t\tlet medianpoints = uniquevals.map(function(uniqueval){\r\n\t\t\tlet relevant = sprites.filter(function(sprite){\r\n\t\t\t\treturn sprite.task[variable] == uniqueval;\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t// Find the medianpoint.\r\n\t\t\treturn {\r\n\t\t\t\tname: uniqueval,\r\n\t\t\t\tx: d3.median(relevant, function(sprite){return parseFloat(sprite.graphic.style.left)}),\r\n\t\t\t\ty: d3.median(relevant, function(sprite){return parseFloat(sprite.graphic.style.top)})\r\n\t\t\t} // medianpoint\r\n\t\t}) // map\r\n\t\t\r\n\t\t// Sort the median points and convert them into direct maps?\r\n\t\tlet xmap = medianpoints\r\n\t\t  .sort(function(a,b){return a.x - b.x})\r\n\t\t  .reduce(function(acc, mpoint, i){\r\n\t\t\t  acc[mpoint.name] = i\r\n\t\t\t  return acc\r\n\t\t  }, {})\r\n\t\t\r\n\t\tlet ymap = medianpoints\r\n\t\t  .sort(function(a,b){return a.y - b.y})\r\n\t\t  .reduce(function(acc, mpoint, i){\r\n\t\t\t  acc[mpoint.name] = i\r\n\t\t\t  return acc\r\n\t\t  }, {})\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: xmap,\r\n\t\t\ty: ymap\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}, // categoricalmapping\r\n\t\r\n\t\r\n\t\r\n\tcategoricalcorrelation: function(sprites, categorical){\r\n\t\t\r\n\t\t// Collect and encode the categorical variables. The encoding in the x and y directions may differ.\r\n\t\t\r\n\t\tlet variable = categorical\r\n\t\t\t\r\n\t\t// Get the mapping from labels to numbers.\r\n\t\tlet mapping = statistics.categoricalmapping(sprites, variable)\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t// Because the categorical encoding can be different along both axes, the correlations need to be calculated twice.\r\n\t\t\r\n\t\t// The midpoints are now ready - do the scores themselves\r\n\t\tlet xd = sprites.map(function(sprite){\r\n\t\t  return {\r\n\t\t\tvar0: parseFloat(sprite.graphic.style.left),\r\n\t\t\tvar1: mapping.x[sprite.task[variable]]\r\n\t\t  } // return\r\n\t\t}) // map\r\n\t\t\r\n\t\tlet yd = sprites.map(function(sprite){\r\n\t\t  return {\r\n\t\t\tvar0: parseFloat(sprite.graphic.style.top),\r\n\t\t\tvar1: mapping.y[sprite.task[variable]]\r\n\t\t  } // return\r\n\t\t}) // map\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tlet xscore = statistics.spearman(xd)\r\n\t\tlet yscore = statistics.spearman(yd)\r\n\t\t\r\n\t\tlet label = {\r\n\t\t\tx: xscore < 0 ? \"- \" + variable : \"+ \" + variable,\r\n\t\t\ty: yscore < 0 ? \"- \" + variable : \"+ \" + variable,\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\tname: variable, \r\n\t\t\tlabel: label,\r\n\t\t\tscore: {\r\n\t\t\t\tx: xscore,\r\n\t\t\t\ty: yscore\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}, // categoricalcorrelation\r\n\t\r\n\t\r\n\tordinalcorrelation: function(sprites, ordinal){\r\n\t\t\r\n\t\tlet variable = ordinal\r\n\t\t// For each of the data variables calculate a correlation.\r\n\t\t\r\n\t\tlet xd = sprites.map(function(sprite){\r\n\t\t  return {\r\n\t\t\tvar0: parseFloat(sprite.graphic.style.left),\r\n\t\t\tvar1: sprite.task[variable]\r\n\t\t  } // return\r\n\t\t}) // map\r\n\t\t\r\n\t\tlet yd = sprites.map(function(sprite){\r\n\t\t  return {\r\n\t\t\tvar0: parseFloat(sprite.graphic.style.top),\r\n\t\t\tvar1: sprite.task[variable]\r\n\t\t  } // return\r\n\t\t}) // map\r\n\t\t\r\n\t\tlet xscore = statistics.spearman(xd)\r\n\t\tlet yscore = statistics.spearman(yd)\r\n\t\t\r\n\t\tlet label = {\r\n\t\t\tx: xscore < 0 ? \"- \" + variable : \"+ \" + variable,\r\n\t\t\ty: yscore < 0 ? \"- \" + variable : \"+ \" + variable,\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\tname: variable, \r\n\t\t\tlabel: label,\r\n\t\t\tscore: {\r\n\t\t\t\tx: xscore,\r\n\t\t\t\ty: yscore\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t}, // ordinalcorrelation\r\n\t\r\n} // statistics\r\n\r\n\r\n\r\n\r\n// Button functionality\r\n\r\n\r\nd3.select(\"#enter\").on(\"click\", function(){\r\n\t// If selection has sprites then only retain those.\r\n\tif(dbsliceData.selected.length > 0){\r\n\t\t\r\n\t\t// Log all sprites that are not selected into hiding.\r\n\t\tlet evicted = dbsliceData.sprites.filter(function(sprite){\r\n\t\t\treturn !dbsliceData.selected.includes(sprite)\r\n\t\t}) // filter\r\n\t\t\r\n\t\tdbsliceData.hiding = evicted\r\n\t\tevicted.forEach(function(sprite){\r\n\t\t\tsprite.graphic.style.display = \"none\"\r\n\t\t})\r\n\t\t\r\n\t\t\r\n\t} // if\r\n\t\r\n})\r\nd3.select(\"#exit\").on(\"click\", function(){\r\n\t// If selection has sprites then only retain those.\r\n\tdbsliceData.selected = []\r\n\tdbsliceData.evicted = []\r\n\tdbsliceData.sprites.forEach(function(sprite){\r\n\t\tsprite.graphic.style.border = \"\"\r\n\t\tsprite.graphic.style.display = \"\"\r\n\t})\r\n\t\r\n})\r\n\r\n\r\nd3.select(\"#correlation-show\").on(\"click\", function(){\r\n\t// If selection has sprites then only retain those.\r\n\t\r\n\tvar scores_\r\n\tif(dbsliceData.selected.length > 1){\r\n\t\tscores_ = statistics.correlation(dbsliceData.selected)\r\n\t} else {\r\n\t\tscores_ = statistics.correlation(dbsliceData.sprites)\r\n\t} // if\r\n\t\r\n\t\r\n\tconsole.log(scores_)\r\n\t\r\n\tlet container = d3.select(\"#correlation-container\")\r\n\tcontainer.style(\"display\", \"\")\r\n\tlet svg = container.select(\"svg\")\r\n\t  \r\n\t\r\n\t\r\n\t// Draw on the svg.\r\n\t\r\n\tlet xscale = d3.scaleLinear()\r\n\t  .domain([-1.1,1.1])\r\n\t  .range([0,500])\r\n\t  \r\n\tsvg.selectAll(\"circle\").remove()\r\n\tsvg.selectAll(\"circle\")\r\n\t  .data( scores_ )\r\n\t  .enter()\r\n\t    .append(\"circle\")\r\n\t\t  .attr(\"cx\", d=>xscale(d.score.x))\r\n\t\t  .attr(\"cy\", d=>xscale(d.score.y))\r\n\t\t  .attr(\"r\", 5)\r\n\t\t  .attr(\"fill\", \"cornflowerblue\")\r\n\t\t  \r\n\t// Let's add some axis.\r\n\tsvg.selectAll(\"g.axis\").remove()\r\n\tvar xaxis = d3.axisBottom(xscale);\r\n    var yaxis = d3.axisRight(xscale);\r\n    svg\r\n\t  .append(\"g\")\r\n\t    .attr(\"class\", \"axis\")\r\n\t\t.call(xaxis);\r\n    svg\r\n\t  .append(\"g\")\r\n\t    .attr(\"class\", \"axis\")\r\n\t\t.call(yaxis);\r\n\t\r\n})\r\n\r\nd3.select(\"#correlation-hide\").on(\"click\", function(){\r\n\td3.select(\"#correlation-container\").style(\"display\", \"none\")\r\n})\r\n\r\n\r\n\r\nd3.select(\"#tsne\").on(\"click\", function(){\r\n\tdbsliceData.tsnesettings.show()\r\n})\r\n\r\n\r\n\r\n\r\n"],"names":["assert","condition","message","getopt","opt","field","defaultval","hasOwnProperty","return_v","v_val","gaussRandom","u","Math","random","v","r","c","sqrt","log","randn","mu","std","zeros","n","isNaN","ArrayBuffer","arr","Array","i","Float64Array","randn2d","d","s","uses","x","xhere","j","push","L2","x1","x2","D","length","x1i","x2i","xtod","X","N","dist","d2p","perplexity","tol","Nf","floor","Htarget","P","prow","betamin","Infinity","betamax","beta","done","maxtries","num","psum","pj","exp","Hhere","abs","Pout","N2","max","sign","tSNE","dim","epsilon","iter","dists","initSolution","Y","gains","ystep","cg","costGrad","cost","grad","ymean","gid","sid","gainid","newgain","momval","newsid","e","yold","cg0","cg1","analytic","numerical","console","pmul","Qu","qsum","dsum","dhere","qu","NN","Q","q","gsum","premult","viewobj","div","v2p","spritewidth","scales","d3","domain","offsetWidth","range","y","offsetHeight","current","view","transform","rescaleX","rescaleY","v2p_new","k","pixelpoint","dom","canvasobj","domA2domB","datapoint","point","A","B","helpers","isIterable","object","Symbol","iterator","makeTranslate","unique","onlyUnique","value","index","self","indexOf","filter","arrayEqual","arrayIncludesAll","f","b","includes","indexOfObjectByAttr","array","attr","findObjectByAttribute","attribute","values","flag","subset","a","collectObjectArrayProperty","C","map","concat","apply","setDifference","Set","aMinusB","_toConsumableArray","has","bMinusA","fitTextToBox","text","box","val","fontSize","style","node","getBoundingClientRect","calculateExponent","createFileInputElement","loadFunction","dataInput","document","createElement","type","onchange","target","files","dbsliceData","sprites","selected","hiding","tsnesettings","undefined","then","metadata","forEach","row","ordinals","varname","Number","task","mouse","position","gettsnescores","call","scaleExtent","on","obj","zooming","dragobj","getMousePosition","calculateNewPosition","xscale","yscale","invert","parseFloat","left","top","selectAll","data","enter","append","path","each","sprite","graphic","parentobj","onlassostart","onlassoend","lassoobj","iswithin","border","overlay","lasso","reposition","animalsinfo","feature","tsne","tsnejs","initDataRaw","step","getSolution","xdom","ydom","wrapper","p","round","d3toolbar","datum","addRange","addButton","hide","submit","icon","event","classname","min","init","html","stopPropagation","perplexitynode","select","epsilonnode","display","mousePosition","wrapperdom","getWrapperPosition","movement","calculateMouseMovement","parseInt","w","h","mp0","mp1","svg","boundary","parentElement","shiftKey","draw","addpoint","remove","isInside","checkIntersect","p0","p1","join","update","exit","categoricals","statistics","correlation","categoricalscores","cat","categoricalcorrelation","ordinalscores","ord","ordinalcorrelation","scores","sort","score","covariance","mu_var0","var0","mu_var1","var1","sum","spearman","cov","sigma_var0","sigma_var1","categoricalmapping","variable","uniquevals","medianpoints","uniqueval","relevant","name","xmap","reduce","acc","mpoint","ymap","categorical","mapping","xd","yd","xscore","yscore","label","ordinal","evicted","scores_","container","xaxis","yaxis","show"],"mappings":"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"}